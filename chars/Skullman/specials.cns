;---------------------------------------------------------------------------
;Special Moves
;---------------------------------------------------------------------------
;---------------------------------------------------------------------------------------------
;Statedef 4000 has additional code that states when the player is in
;statedef 1000 then Rush will changestate into statedef 1001. This
;code is only necessary is your character will have a Partner such as
;Rush or Treble, otherwise this statedef should be made into some other kind of
;special move.
;Power Set Default;-------------------------------------------------------------------------



;---------------------------------------------------------------------------------------------
; Powerblaster (X)
[Statedef 1000]
type    = S
movetype= A
physics = C
juggle  = 4
ctrl = 0
anim = 1000
poweradd =  50
sprpriority = 2
velset = 0,0

[State 0, Explod]
type = Explod
trigger1 = !time && Pos Y = 0
anim = 6012
ID = 6012
pos = -30,10
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 1
vel = 0,0
accel = -0.2,0
random = 0,0
removetime = -2
pausemovetime = 0
scale = 1,1
sprpriority = 30
ontop = 0
shadow = 0,0,0
ownpal = 1
removeongethit = 0

[State 430, VelMul, corrida]
type = VelMul
trigger1 = Time = 0
trigger1 = PrevStateNo = 100
x = .8

[State 210,2] 
type = PlaySnd
trigger1 = Animelem = 4
value = s15,1

[State 3408, Helper]
type = Helper
trigger1 = Animelem = 4
helpertype = normal ;player
name = "PowerShot"
ID = 1050
stateno = 1050
pos = 52,-35
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 0

[State 430, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;------------------------------------------------------------------------------------------------------------------
;Powerblaster (Y)
[Statedef 1010]
type    = S
movetype= A
physics = S
juggle  = 4
ctrl = 0
anim = 1010
poweradd = 50
sprpriority = 2
velset = 0,0



[State 0, Explod]
type = Explod
trigger1 = !time && Pos Y = 0
anim = 6012
ID = 6012
pos = -30,10
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 1
vel = 0,0
accel = -0.2,0
random = 0,0
removetime = -2
pausemovetime = 0
scale = 1,1
sprpriority = 30
ontop = 0
shadow = 0,0,0
ownpal = 1
removeongethit = 0

[State 210,2] 
type = PlaySnd
trigger1 = Animelem = 3
value = s15,1

[State 0, PosAdd]
type = PosAdd
trigger1 = animelem = 1
x = -5

[State 230, VelMul, corrida]
type = VelMul
trigger1 = Time = 0
trigger1 = PrevStateNo = 100
x = .8

[State 3408, Helper]
type = Helper
trigger1 = Animelem = 4
helpertype = normal ;player
name = "PowerShot"
ID = 1050
stateno = 1050
pos = 24,-41
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 0

[State 0, PosAdd]
type = PosAdd
trigger1 = animelem = 7
x = 5

[State 230, ChangeState]
type = ChangeState
trigger1 = animtime = 0
value = 0
ctrl = 1


;------------------------------------------------------------------------------------------------------------------
;Powerblaster (Z)
[Statedef 1020]
type    = S
movetype= A
physics = S
juggle  = 4
ctrl = 0
anim = 1020
poweradd = 50
sprpriority = 2
velset = 0,0

[State 0, Explod]
type = Explod
trigger1 = !time && Pos Y = 0
anim = 6012
ID = 6012
pos = -30,10
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 1
vel = 0,0
accel = -0.2,0
random = 0,0
removetime = -2
pausemovetime = 0
scale = 1,1
sprpriority = 30
ontop = 0
shadow = 0,0,0
ownpal = 1
removeongethit = 0


[State 210,2] 
type = PlaySnd
trigger1 = Animelem = 5
value = s15,1

[State 230, VelMul, corrida]
type = VelMul
trigger1 = Time = 0
trigger1 = PrevStateNo = 100
x = .8

[State 3408, Helper]
type = Helper
trigger1 = Animelem = 5
helpertype = normal ;player
name = "PowerShotUpward"
ID = 1060
stateno = 1060
pos = 20,-68
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 0


[State 230, ChangeState]
type = ChangeState
trigger1 = animtime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------------------------
;Special #1 Powerblaster
[Statedef 1025]
type    = A
movetype= A
physics = A
juggle  = 4
ctrl = 0
anim = 1025
poweradd = 50
sprpriority = 2
velset = -1,-3;y-1.5,-2.5

[State 210,2] 
type = PlaySnd
trigger1 = Animelem = 3
value = s15,1

[State 3408, Helper]
type = Helper
trigger1 = Animelem = 3
helpertype = normal ;player
name = "PowerShot"
ID = 1050
stateno = 1050
pos = 46,-65
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 0

[State 630, ChangeState]
type = ChangeState
trigger1 = AnimTime = 0
value = 50


;--------------------------------------------------------------------------------
;FWD Projectile
[Statedef 1050]
type    = A
movetype= A
physics = N
juggle  = 1
velset = 7,0
anim = 1050
ctrl = 0
sprpriority = 3

[State 1350, Assert]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 1350, VelAdd]
type = VelAdd
trigger1 = 1
x = .5
 
[State 1350, HitBy]
type = HitBy
trigger1 = 1
value = SCA, AP
time = 1
 
[State 1350, HitOverride]
type = HitOverride
trigger1 = Time <= 0
time = -1
attr = SCA, NP, SP, HP
slot = 0
stateno = 1055

[State 1350, 2]
type = HitDef
trigger1 = time = 0
attr = A, SP
damage    = ceil(55 * parent, fvar(11)),7
animtype = Light
hitflag = MAF
guardflag = MA
priority = 4;, Hit
pausetime = 8, 8
sparkno = S25000+random%2
sparkxy = 0, 0
guard.sparkno=S25008
hitsound   = s8000,0
guardsound = s8500,0
ground.type = Low
ground.slidetime = 15
ground.hittime  = 18
ground.velocity = -5,0
air.hittime = 18
air.velocity = -3,-1.5
air.fall = 1

[State 0, ChangeAnim]
type = ChangeState
trigger1 = movecontact || movereversed
value = 1055
ignorehitpause = 1

[State 1350, DestroySelf]
type = DestroySelf
trigger1 = FrontEdgeDist < -40
trigger2 = anim = 1 && animelemtime(1) >= 10


;--------------------------------------------------------
;FWD Projectile Colided
[Statedef 1055]
type    = A
juggle  = 0
velset = 1,0
anim = 1055;6001
ctrl = 0
sprpriority = 3

[State 2244, Assert]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 0, DestroySelf]
type = DestroySelf
trigger1 = Animtime = 0


;--------------------------------------------------------------------------------
;Diag. Projectile
[Statedef 1060]
type    = A
movetype= A
physics = N
juggle  = 1
velset = 5, -2
anim = 1060
ctrl = 0
sprpriority = 3

[State 2244, Assert]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 0, VelAdd]
type = VelAdd
trigger1 = 1
x = .5
y = -.5
 
[State 1210, HitBy]
type = HitBy
trigger1 = 1
value = SCA, AP
time = 1
 
[State 1210, HitOverride]
type = HitOverride
trigger1 = Time <= 0
time = -1
attr = SCA, NP, SP, HP
slot = 0
stateno = 1065

[State 3405, 2]
type = HitDef
trigger1 = time = 0
attr = A, SP
damage    = ceil(65 * parent, fvar(11)),7
animtype = Light
hitflag = MAF
guardflag = MA
priority = 4; Hit
pausetime = 8, 8
sparkno = S25000+random%2
guard.sparkno=S25008
sparkxy = 0, 0
hitsound   = s8000,0
guardsound = S8500,0
ground.type = High
ground.slidetime = 15
ground.hittime  = 18
ground.velocity = -2,0
air.velocity = -3.7,-2
air.fall = 1

[State 0, ChangeAnim]
type = ChangeState
trigger1 = movecontact || Movereversed
value = 1065

[State 1350, DestroySelf]
type = DestroySelf
trigger1 = FrontEdgeDist < -40
trigger2 = anim = 1 && animelemtime(1) >= 10


;--------------------------------------------------------
;Diag. Projectile Colided
[Statedef 1065]
type    = A
juggle  = 0
velset = 0,0
anim = 1065;6002
ctrl = 0
sprpriority = 9

[State 2244, Assert]
type = assertspecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 0, DestroySelf]
type = DestroySelf
trigger1 = Animtime = 0


;-------------------------------------------------
; Skull Barrier
[Statedef 1100]
type    = S
movetype= A
physics = S
ctrl = 0
anim = 1100 + ifelse(Numhelper(1150), 25, 0)
juggle  = 4
poweradd = 50

[State 0, PosAdd]
type = PosAdd
triggerall = anim = 1125
trigger1 = animelem = 1
trigger2 = animelem = 5
x = ifelse(animelemno(0) = 1, 6, -6)

[State 0, Explod]
type = Explod
trigger1 = !time && Pos Y = 0
anim = 6012
ID = 6012
pos = -30,10
postype = p1  ;p2,front,back,left,right
facing = 1
vfacing = 1
bindtime = 1
vel = 0,0
accel = -0.2,0
random = 0,0
removetime = -2
pausemovetime = 0
scale = 1,1
sprpriority = 30
ontop = 0
shadow = 0,0,0
ownpal = 1
removeongethit = 0


[State 0, PlaySnd]
type = PlaySnd
trigger1 = anim = 1100
trigger1 = Animelem = 1 && numhelper(1150) = 0
value = S13,0
volumescale = 80
channel = 0

[State 0, Helper]
type = Helper
trigger1 = anim = 1100
trigger1 = animelem = 4 && numhelper(1150) = 0
helpertype = normal ;player
name = "SkullBarrier"
ID =1150
stateno =1150
pos = -17, -37
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 0
size.xscale = .85
size.yscale = .85
supermove =999999
pausemove =999999
persistent =1

[State 1122, ChangeState]
type = ChangeState
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------
;Barrier Mother Helper
[Statedef 1150]
type    = S
movetype= I
physics = S
ctrl = 0
anim = 1150
sprpriority = 0

[State 1035, VarAdd]
type = VarAdd
trigger1 = 1
var(1) = 1

[State 1035, VarAdd]
type = VarAdd
trigger1 = !Time
var(2) = 1

[State 2150, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = ifelse(var(2) < 8, 1150, 1155)
time = -1
ignorehitpause = 1

[State 2150, HitBy]
type = HitBy
trigger1 = 1
value = SCA, AP; Only hit by All P types: (NP, SP, HP)
time = -1
ignorehitpause = 1

[State 1150, 1]
type = BindToParent
trigger1 = 1
pos = ifelse(parent, anim = 1100 && parent, animelemtime(6) < 0, -17, 4), -37 ;by Phantom.of.the.Server
time = -1
ignorehitpause = 1

[State 0, Helper]
type = Helper
trigger1 = !time
trigger1 = !prevstateno
helpertype = normal ;player
name = "skull 1"
ID = 1151
stateno = 1151
pos = 0, -30
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
pausemovetime = 9999
supermovetime = 9999

[State 0, Helper]
type = Helper
trigger1 = !time
trigger1 = !prevstateno
helpertype = normal ;player
name = "skull 2"
ID = 1152
stateno = 1152
pos = 0, -30
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
pausemovetime = 9999
supermovetime = 9999

[State 0, Helper]
type = Helper
trigger1 = !time
trigger1 = !prevstateno
helpertype = normal ;player
name = "skull 3"
ID = 1153
stateno = 1153
pos = 0, -30
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
pausemovetime = 9999
supermovetime = 9999

[State 0, Helper]
type = Helper
trigger1 = !time
trigger1 = !prevstateno
helpertype = normal ;player
name = "skull 4"
ID = 1154
stateno = 1154
pos = 0, -30
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 1
pausemovetime = 9999
supermovetime = 9999

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 1
trigger1 = !prevstateno
value = S3,0
channel = -1

[State 1498, changestate]
type = changestate
trigger1 = var(1) >= 740
trigger2 = root, stateno = 1300
trigger3 = !(root, alive)
trigger4 = root, stateno = 1100 && root, anim = 1125
value = 1155

;---------------------------------------------------------------------------
;MM4 Skullman 1
[statedef 1151]
type = A
movetype = I
physics = N
ctrl = 0
poweradd = 20
velset = 0,0
sprpriority = 50

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = !time 
value = 1155

[State 632, 1]
type = palfx
trigger1 = !time
time = 10
sinadd =  255,255,255,20
ignorehitpause = 1

[State 1498, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[State 1150, 1]
type = BindToParent
trigger1 = 1
pos = cos((time-3)/25.0*pi)*50, sin((time-3)/25.0*pi)*50 ;by Phantom.of.the.Server
time = -1
ignorehitpause = 1

[State 0, changeanim]
type = changeanim
triggerAll = anim != 1156 
trigger1 = parent, var(2) = 3
trigger2 = parent, stateno = 1155
value = 1156

[State 0, DestroySelf]
type = DestroySelf
trigger1 = anim = 1156 && !animtime

;---------------------------------------------------------------------------
;MM4 Skullman 2
[statedef 1152]
type = A
movetype = I
physics = N
ctrl = 0
poweradd = 20
velset = 0,0
sprpriority = 50

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = !time 
value = 1155

[State 632, 1]
type = palfx
trigger1 = !time
time = 10
sinadd =  255,255,255,20
ignorehitpause = 1

[State 1498, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[State 1150, 1]
type = BindToParent
trigger1 = 1
pos = cos((time+22)/25.0*pi)*50, sin((time+22)/25.0*pi)*50 ;by Phantom.of.the.Server
time = -1
ignorehitpause = 1

[State 0, changeanim]
type = changeanim
triggerAll = anim != 1156 
trigger1 = parent, var(2) = 5
trigger2 = parent, stateno = 1155
value = 1156

[State 0, DestroySelf]
type = DestroySelf
trigger1 = anim = 1156 && !animtime

;---------------------------------------------------------------------------
;MM4 Skullman 3
[statedef 1153]
type = A
movetype = I
physics = N
ctrl = 0
poweradd = 20
velset = 0,0
sprpriority = 50

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = !time 
value = 1155

[State 632, 1]
type = palfx
trigger1 = !time
time = 10
sinadd =  255,255,255,20
ignorehitpause = 1

[State 1498, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[State 1150, 1]
type = BindToParent
trigger1 = 1
pos = cos((time-41)/25.0*pi)*50, sin((time-41)/25.0*pi)*50 ;by Phantom.of.the.Server
time = -1
ignorehitpause = 1

[State 0, changeanim]
type = changeanim
triggerAll = anim != 1156 
trigger1 = parent, var(2) = 7
trigger2 = parent, stateno = 1155
value = 1156

[State 0, DestroySelf]
type = DestroySelf
trigger1 = anim = 1156 && !animtime

;---------------------------------------------------------------------------
;MM4 Skullman 4
[statedef 1154]
type = A
movetype = I
physics = N
ctrl = 0
poweradd = 20
velset = 0,0
sprpriority = 50

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = !time 
value = 1155

[State 632, 1]
type = palfx
trigger1 = !time
time = 10
sinadd =  255,255,255,20
ignorehitpause = 1

[State 1498, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[State 1150, 1]
type = BindToParent
trigger1 = 1
pos = cos((time-16)/25.0*pi)*50, sin((time-16)/25.0*pi)*50 ;by Phantom.of.the.Server
time = -1
ignorehitpause = 1

[State 0, PlaySnd]
type = PlaySnd
triggerAll = anim = 1155
trigger1 = time = 125
trigger2 = time = 200
trigger3 = time = 275
trigger4 = time = 350
trigger5 = time = 425
trigger6 = time = 500
trigger7 = time = 575
trigger8 = time = 650
value = S3,1
channel = 1

[State 0, changeanim]
type = changeanim
triggerAll = anim != 1156 
trigger1 = parent, var(2) = 9
trigger2 = parent, stateno = 1155
value = 1156

[State 0, StopSnd]
type = StopSnd
trigger1 = anim = 1156
trigger1 = animelem = 1
channel = 1

[State 0, DestroySelf]
type = DestroySelf
trigger1 = anim = 1156 && !animtime

;------------------------------------
; Barrier Destroyed
[Statedef 1155]
type    = S
movetype= A
physics = N
ctrl = 0
velset = 0, 0
anim = 1
sprpriority = 0

[State 1155, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow

[State 1155, DestroySelf]
type = DestroySelf
trigger1 = !Numhelper(1151)
trigger1 = !Numhelper(1152)
trigger1 = !Numhelper(1153)
trigger1 = !Numhelper(1154)

;-------------------------------------------------
; Teleport
[Statedef 1200]
type    = S
movetype= I
physics = S
poweradd= 50
velset = 0, 0
anim = 1200
ctrl = 0
sprpriority = 2

[State 0, VarSet]
type = VarSet
trigger1 = !time
trigger1 = !Ailevel
v = 31
value = ifelse(command = "QCBz", 2, ifelse(command = "QCBy", 1, 0))

;TODO: check for walls dammit!
[State 0, VarSet]
type = VarSet
trigger1 = !time
trigger1 = Ailevel
v = 31
value = ifelse(p2bodydist x < 50, 0, ifelse(p2bodydist x < 100, 1, 2))

[State 0, Width]
type = Width
trigger1 = anim = 1200
trigger1 = Animelemtime(3) >= 0
player = 0, 0

[State 0, PlayerPush]
type = PlayerPush
trigger1 = anim = 1200
trigger1 = Animelemtime(3) >= 0
trigger2 = anim = 1250
trigger2 = Animelemtime(13) < 0
value = 0

[State 0, NotHitBy]
type = NotHitBy
trigger1 = anim = 1200
trigger1 = Animelemtime(3) >= 0
value = SCA, AA, AP, AT

[State 0, PlaySnd]
type = PlaySnd
trigger1 = !var(22)
trigger1 = anim = 1200
trigger1 = Animelem = 1
value = S7,1

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = anim = 1200
trigger1 = AnimTime = 0 
value = 1250

[State 0, VelSet]
type = PosAdd
trigger1 = anim = 1250
trigger1 = Animelem = 1
x = ifelse(var(31) = 2, 255, ifelse(var(31) = 1, 125, -159)) ;0 = 159, 1 = 125

[State 0, Turn]
type = Turn
triggerAll = anim = 1250
triggerAll = animelem = 1 || animelem = 3 || animelem = 5
trigger1 = facing = 1
trigger1 = pos x > enemynear, pos x
trigger2 = facing = -1
trigger2 = pos x < enemynear, pos x

[State 0, VarSet]
type = VarSet
trigger1 = anim = 1250
trigger1 = AnimElem = 12
v = 22
value = 0

[State 0, PlaySnd]
type = PlaySnd
trigger1 = anim = 1250
trigger1 = Animelem = 13
value = S7,0

[State 1500, 3]
type = ChangeState
trigger1 = anim = 1250
trigger1 = AnimTime = 0 
value = 0
ctrl = 1

;----------------------------------------------------------------------------------------------------------
; Invisibility Toggle
[Statedef 1300]
type = S
movetype = I
physics = S
sprpriority = 2
velset = 0, 0
poweradd= 50
ctrl = 0

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = ifelse(var(22), 1250, 1200)

[State 0, PlaySnd]
type = PlaySnd
trigger1 = anim = 1200
trigger1 = Animelem = 1
value = S7,1

[State 0, PlaySnd]
type = PlaySnd
trigger1 = anim = 1250
trigger1 = Animelem = 13
value = S7,0

[State 0, VarSet]
type = VarSet
trigger1 = anim = 1200
trigger1 = AnimElem = 12
trigger2 = anim = 1250
trigger2 = AnimElem = 2
v = 22
value = ifelse(anim = 1200, 1, 0)

[State 3408, Helper]
type = Helper
trigger1 = var(22)
helpertype = normal ;player
name = "Charger helper"
ID = 1350
stateno = 1350
pos = 24,-41
postype = p1    ;p2,front,back,left,right
facing = 1
keyctrl = 0
ownpal = 0

[State 0, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 0
ctrl = 1


;----------------------------------------------------------------------------------------------------------
; Okay what the fuck is this!?
; It gives skull man some power for his meter while he's invisible as a reward for players being able to keep
; the invisibility on
; Invisibility Power charger helper
[Statedef 1350]
type = U
movetype = I
physics = N
anim = 1
ctrl = 0

[State 0, PowerAdd]
type = PowerAdd
trigger1 = time % 25 = 0
value = 2

[State 0, DestroySelf]
type = DestroySelf
triggerall = !(parent, var(22))
trigger1 = root, stateno = [1100,1300]
trigger2 = root, stateno = [3000,3999]

